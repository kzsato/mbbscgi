============================================================
【スクリプト名】　mbbs.cgi(改)  Ver 1.5.0.1-RC1
【 著 作  】　Copyright(C) 2001-2008 horn
【動作確認環境】　RedHat + Apache
                  VineLinux + Apache
【 原 作  】　mbbs.cgiv1.93 & v2.03 & v3.02 by suzukyu 氏
============================================================
本スクリプトは、suzukyu氏によるmbbs.cgiをもとに、
hornが、自分の欲しい機能を勝手に追加してできたスクリプトです。
動作保証は一切ありません。


※セキュリティ強化のためにも
　ユーザーデータ保存ファイルの名前は必ず変更してください。

※デバイス情報ファイルは必ず別途DLしてください。
　ここに入っているのはいつのだかわかりませんので。
　管理メニューからも更新ができます！

参考ディレクトリ構成
[mbbs]
 |
 +--readme.txt               これ　upしないでくださいね。
 +--mbbs.cgi    (701)(705)   基本処理スクリプト
 +--mbbs_ini.pl (600)(604)   基本設定ファイル
 +--*IP_Base.pm (600)(604)   必要な場合はDLしオプション設定してください。
 |
 +[lib]
 | +xh.pl       (600)(604)   xhtml処理ライブラリ
 | +ch.pl       (600)(604)   chtml処理ライブラリ
 | +hd.pl       (600)(604)   hdml処理ライブラリ
 | +pc.pl       (600)(604)   pc処理ライブラリ
 | +session.pl  (600)(604)   セッション処理ライブラリ
 | |
 | +write.pl    (600)(604)   書込処理ライブラリ　端末詳細判別が不要な場合
 | |                          write2をリネームの上差し替えて使用してください。
 | +jcode.pl    (600)(604)   いわずもがな
 |
 +[ini]
 | +passcode.dat(600)(604)   パスワード保存ファイル
 | +mbbs.css    (604)(604)   css
 | +device.txt  (600)(604)   デバイス情報保存ファイル
 | +device.log  (600)(604)   デバイス情報更新ログ
 | +mbbs.log    (600)(604)   ログファイル
 | +userfile.cgi(600)(604)   WAP2.0機用cookie代用処理保存ファイル(暫定)
 | +session.cgi (600)(604)   セッション情報保存ファイル(現状管理者のみ)
 |
 +[img]
 | +割愛
 |
 +[txt]
 | +割愛
 |
 +*[ipcheck]  必要な場合はDLしオプション設定してください。
   +割愛

●mbbs.cgi(改)の概要

ほとんど原作のままです(爆
mbbsの本家からいただいてカスタマイズするのが賢いと思います。

●使用方法

 使用方法本家に準じます。

●使用許諾
・これはフリーウェアです。
・本ソフトウェアに対しては、いかなる保証も行ないません。
・制作者はバグフィックスの義務を負いませんができる限りのことはします。
・再配布は基本的にご遠慮ください。サイトの紹介をお願いします(^^)
・商用利用の場合、事前に承諾が必要です。



◎v1.5.0.1の変更点
[機能追加]
・管理画面にセッション管理を導入
　パスワードを1度入力すれば所定の時間セッションが保持される気がします。
　現在10分間保持する気がします。要望により、iniに項目作りますがいりますか？
・検索結果からの返信に対応
　かねてより機能追加要望のあった機能を補完

[ファイル]
以下のファイルを追加[08.03.07]
./lib/session.pl
./ini/session.cgi

[mbbs_ini.cgi]
v1.41
$UseWKeyChk	追加					[08.03.07]
$SessionFile	追加					[08.03.07]
$SessionLib	追加					[08.03.07]

[mbbs.cgi]
v1.5.0.1-rc1
やりやすいところから外で使わない変数の隠匿化に着手	[08.03.07]
・get_time
・set_cookie
・save_user_data
変数名を整理						[08.03.07]
・CheckDeviceTxt
コメントアウトしてあった行をだいぶ削除			[08.03.07]
基本処理PCより呼び出す管理モードの認証処理ルーチンを変更[08.03.07]
エラー処理を追加					[08.03.07]
・auth_er		認証エラーが発生しました。
・undefなコードでerrorを呼び出した場合そのまま出力する

[session.pl]
v1.0
新設
まだコメントが不十分だと思います。すみません
汚いソースですがいじる方は読んでください・・・

[write.pl][write2.pl]
v1.040
・Vista判別対応にしたりいろいろしました。
　処理系に変更はないので気になる方のみご覧ください。

[pc.pl]
・引数の渡し方変更しました。
　管理系の画面はすべてin{'pwd'}を表示しなくしました。
・書き込みキーワードのオプション化にともない処理整理しました。


○v1.5.0.0の変更点
[ファイル]
オプションとして以下のモジュールをサポート[08.02.15]
	./IP_Base.pm
	./ipcheck/*

[mbbs_ini.cgi]
v1.40
$use_ipcheck		追加				[08.02.15]
$DeviceInfo_host	追加				[08.02.15]
$CheckDevInfoDate	追加				[08.02.15]
$CheckDevInfoData	追加				[08.02.15]
$CheckDevInfoLog	追加				[08.02.15]

[mbbs.cgi]
PC動作時の管理モードにupdate追加			[08.02.15]
sub CheckDeviceTxt 追加					[08.02.15]
エラー処理に以下の3点を追加				[08.02.15]
・inet_er		ホスト名が解決できませんでした。
・socket_er		ソケット生成に失敗しました。
・port_er		ポートエラーが発生しました。


[write.pl]
タグの禁止処理直前にipcheck処理(オプション)追加		[08.02.15]

[write2.pl]
タグの禁止処理直前にipcheck処理(オプション)追加		[08.02.15]

[pc.pl]
sub updateResult 追加					[08.02.15]
管理フォームにデバイス情報更新処理へのメニュー追加	[08.02.15]

ごんちゃ氏提供の端末判別をマージしたつもり		[08.02.15]

△v1.435の変更点
書き込みキーワード導入(./mbbs.cgi ./lib/pc.pl)		[06.03.30]
検索処理の再修正(./mbbs.cgi)				[05.??.??]

○以前の変更点
PCSVの機種判定対応(./lib/write.pl)			[05.09.19]
xhtml画面の変更(途上)(./lib/xh.pl)			[05.09.11]
検索処理のセキュリティ問題を修正			[05.09.05]
削除後のエラー画面問題修正				[05.05.28]
ユーザー削除ができない問題の修正(mbbs.cgi)		[05.05.26]
xhtmlフォームの修正(./lib/xh.pl)			[05.03.09]
とりあえずのライブラリ化　
まだまだ途上です。落ち着いたらmbbs5.000に挑戦します。
というか、今回はただファイルを分割してみただけで実際なにも変わっていません。
(サーバー負荷が若干軽減かもしれません(?)
これから重複処理の削減などを進めようかと。
とりあえず、本体の大きさをだいぶ小さくできたので良しとして今回の改訂を終了。

html4.01準拠が中途半端なためにエラーがでる可能性があります。
気になる方は最初の事前処理（ブラウザ種別判定）と
端末処理部分などだけ抜き出しv1.35の一部に上書きするなりして使ってください。
あまり気にしなくても大丈夫だとは思いますが念のためここに書いておきます。


●v1.36まで
・えあーえっぢふぉんに対応
・cssサポート
・西暦表示付加
・xhtmlクッキー代替機能実装
・本家のサポート掲示板No.1399にて話題になった機能に対応。
・i-mode、J-Skyのアクセス時表示をezwebと共通化（少しは）
　メニュー構造にはやはり違いが残る、、、。
・デバイス情報ファイルの別提供
・他社の最新機種対応したつもりです。
・広告挿入機能
・親記事表示時に投稿者名表示可能
・パケ代節約機能
　hdml,xhtml版においてヘッダを工夫することにより読み込み回数を減らしました。
　人によってはかなり安くなる（はず
　まだまだ改良の余地ありの機能です。
・v3.02風の表示
・xhtml完全対応
・機種名表示対応 ※他社も対応したつもり
・ログの機種名保存方法が違いますのでその部分は変換が必要です。
ほか

ソース見て研究してください。


